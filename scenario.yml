---
include:
  - intents.yml
  - slots.yml
scenario:
  invocation: 'Food Diary'
  name: 'Food Diary'
  locale: de-DE
  category: EDUCATION_AND_REFERENCE
  examplePhrases:
    - 'Alexa, öffne ernährungstagebuch'
    - 'Alexa, starte ernährungstagebuch'
  steps:


    - name: Initial Step
      entrypoint: true
      actions:
        - sendText: 'Was hast Du gegessen?'
        - getInput:
      next:
        total_energy_metabolism: total energy metabolism
        which_food: API Request
        help: Help
        AMAZON.CancelIntent: Exit
        AMAZON.StopIntent: Exit
        AMAZON.HelpIntent: Help


    - name: API Request
      actions:
        - getUrl:
            url: 'https://oqqg2nqhrd-dsn.algolia.net/1/indexes/foods?query={{food_name}}&x-algolia-application-id=OQQG2NQHRD&x-algolia-api-key=ed77ea09e034941bccd67e8a329cc251'
        - setContext:
            from: '{{ urlResponse.hits[0].portioncal | replace({"\"": ""}) }}'
            to: food_name_response
      next: Read Calories

    - name: Read Calories
      actions:
        - sendText: '{{ food_name }} hat {{ food_name_response }} Kalorien. '
        - sendText: 'Hast Du noch etwas gegessen?'
        - getInput:
      next:
        next_coin: Initial Step
        no_thanks: Exit
        which_food: API Request

    - name: total energy metabolism
      actions:
        - sendText: 'Jetzt helfe ich Dir das zu berechnen. '
      next: gender

    - name: gender
      actions:
        - sendText: 'Bist Du männlich oder weiblich? '
        - getInput:
      next:
        gender: old step

    - name: old step
      actions:
        - sendText: 'Wie alt bist Du? '
        - getInput:
      next:
       old: weight step

    - name: weight step
      actions:
        - sendText: 'Wieviel wiegst Du?'
        - getInput:
      next:
        weight: height step

    - name: height step
      actions:
        - sendText: 'Wie groß bist Du in Zentimeter?'
        - getInput:
      next:
        height: aktivity_level step

    - name: aktivity_level step
      actions:
        - sendText: 'Wie aktiv bist du geöwhnlich, sage leicht, normal, mäßig oder aktiv '
        - getInput:
      next: basal metabolic rate

    - name: basal metabolic rate
      actions:
        - setContext:
            from: >
                {% if gender == 'männlich' %}{655.1+(9.6*gewicht)+(1.8*groesse)-(4.7*alter)}{% endif %}
                {% if gender == 'weiblich' %}{66.4+(13.7*gewicht)+(5*groesse)-(6.8*alter)}{% endif %}
            to: 'matabolic_rate'
        - sendText: 'Du bist {{gender}}'
      next: total energy metabolism



    - name: Exit
      entrypoint: true
      actions:
        - sendText: '{% if food_name is defined %}OK, next time just open Coin Cap to see the latest price of {{ food_name }}.{% endif %} {{ random(["Tschüss", "auf wiedersehen", "Goodbye", "bis dann"])}}'

    - name: Help
      entrypoint: true
      actions:
        - sendText: 'Sage einfach Dein Lebensmittel und ich rechne Dir die Kalorien aus?'
        - getInput:
      next:
        which_food: API Request
        no_thanks: Exit
